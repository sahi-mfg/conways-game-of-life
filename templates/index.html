<!-- templates/index.html -->
<!DOCTYPE html>
<html>

<head>
    <title>Conway's Game of Life</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
    <form id="game-settings">
        <label for="initial-cells">Initial cells:</label>
        <input type="number" id="initial-cells" name="initial-cells" min="1" required>
        <label for="generations">Generations:</label>
        <input type="number" id="generations" name="generations" min="1" required>
        <label for="speed">Speed:</label>
        <input type="number" id="speed" name="speed" min="0.1" max="1" step="0.1" required>
        <button type="submit">Start</button>
    </form>
    <div id="grid-container"></div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $('#game-settings').submit(function (e) {
                e.preventDefault();

                var initialCells = $('#initial-cells').val();
                var generations = $('#generations').val();
                var speed = $('#speed').val();

                $.ajax({
                    url: '/start',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        initial_cells_alive: initialCells,
                        num_iterations: generations,
                        speed: speed
                    }),
                    success: function (response) {
                        var generations = response;
                        var intervalId = setInterval(function () {
                            if (generations.length === 0) {
                                clearInterval(intervalId);
                                return;
                            }

                            var gridData = generations.shift();
                            updateGrid(gridData);
                        }, speed * 1000);
                    }
                });
            });

            $(document).ready(function(){
                $('#start-button').click(function(){
                    var initialCellsAlive = $('#initial-cells-alive').val();
                    var numIterations = $('#num-iterations').val();

                    $.ajax({
                        url: '/start',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            initial_cells_alive: initialCellsAlive,
                            num_iterations: numIterations
                        }),
                        success: function(response) {
                            var generations = response;
                            var intervalId = setInterval(function() {
                                if (generations.length === 0) {
                                    clearInterval(intervalId);
                                    return;
                                }

                                var gridData = generations.shift();
                                updateGrid(gridData);
                            }, 1000);
                        }
                    });

                });
            });

            function updateGrid(gridData) {
                var gridContainer = $('#grid-container');
                gridContainer.empty(); // Clear the current grid

                for (var i = 0; i < gridData.length; i++) {
                    var row = $('<div class="row"></div>');
                    for (var j = 0; j < gridData[i].length; j++) {
                        var cell = $('<div class="cell"></div>');
                        if (gridData[i][j] === 1) {
                            cell.addClass('alive');
                        }
                        row.append(cell);
                    }
                    gridContainer.append(row);
                }
            }
    </script>
</body>

</html>